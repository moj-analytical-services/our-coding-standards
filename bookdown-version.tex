\PassOptionsToPackage{unicode=true}{hyperref} % options for packages loaded elsewhere
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provides euro and other symbols
\else % if luatex or xelatex
  \usepackage{unicode-math}
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\usepackage{hyperref}
\hypersetup{
            pdftitle={DASD Coding Principles},
            pdfauthor={Data Science Hub},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Fix footnotes in tables (requires footnote package)
\IfFileExists{footnote.sty}{\usepackage{footnote}\makesavenoteenv{longtable}}{}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

\usepackage{booktabs}
\usepackage[]{natbib}
\bibliographystyle{apalike}

\title{DASD Coding Principles}
\author{Data Science Hub}
\date{}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{intro}{%
\chapter*{Introduction}\label{intro}}
\addcontentsline{toc}{chapter}{Introduction}

This document contains the Data and Analytical Service Directorate's (DASD) coding principles. These have been developed to help DASD adopt a standard approach for coding projects, ensuring that our work is high quality, maintainable and reusable and that we are able to collaborate effectively.

These coding principles are by no means a list of rules, but seek to provide guidance on how we can achieve `best practice' in our coding - there will always be exceptions, but you should expect to be challenged if you go your own way. These ideas are always open to debate and you are encouraged to contribute to the discussion.

\hypertarget{structure}{%
\subsubsection*{Document structure}\label{structure}}
\addcontentsline{toc}{subsubsection}{Document structure}

The first part of this document contains the four \protect\hyperlink{principles}{coding principles}, with details on some practical actions that can be taken to follow them.

The second part of the document contains additional resources that may be helpful in understanding how to apply the principles, including the suggested \protect\hyperlink{wf}{project workflow}, a \protect\hyperlink{checklist}{project checklist} and a \protect\hyperlink{ksresources}{knowledge share resource list}.

If you're unfamiliar with the suggested workflow (particularly with regards to the use of Github), we recommend that you read through the \protect\hyperlink{wf}{workflow section} before reading through the coding principles. This is because an understanding of the overall structure of a project will aid understanding of how and where the coding principles should be applied.

\hypertarget{contributing}{%
\subsubsection*{Contributing}\label{contributing}}
\addcontentsline{toc}{subsubsection}{Contributing}

If you think that something is missing or not quite right you should either \protect\hyperlink{versioncontrol}{contribute directly} or \href{https://github.com/moj-analytical-services/our-coding-standards/issues}{raise an issue} on Github.

\hypertarget{part-principles}{%
\part{Principles}\label{part-principles}}

\hypertarget{principles}{%
\chapter*{Coding Principles}\label{principles}}
\addcontentsline{toc}{chapter}{Coding Principles}

We want to aim for code that is:

\textbf{1. \protect\hyperlink{understand}{Understandable}}

\begin{itemize}
\tightlist
\item
  Projects should be \protect\hyperlink{structure2}{structured} with clear logical separation of parameters, assumptions, data and code, with appropriate documentation.
\item
  As far as possible, code should follow the \protect\hyperlink{style}{style guidance} outlined.
\end{itemize}

\textbf{2. \protect\hyperlink{accurate}{Accurate}}

\begin{itemize}
\tightlist
\item
  Projects should include \protect\hyperlink{unittest}{testing}.
\item
  All code should be \protect\hyperlink{review}{reviewed}.
\end{itemize}

\textbf{3. \protect\hyperlink{collaborate}{Collaborative}}

\begin{itemize}
\tightlist
\item
  Projects should follow the \protect\hyperlink{flow}{Github workflow}.
\item
  Knowledge should be \protect\hyperlink{knowledge}{shared}.
\end{itemize}

\textbf{4. \protect\hyperlink{reproduce}{Reproducible}}

\begin{itemize}
\tightlist
\item
  \protect\hyperlink{projdep}{Project dependencies} should be managed.
\item
  The \protect\hyperlink{format}{format} of the output should be chosen with reproducibility in mind.
\item
  Projects should be \protect\hyperlink{change}{optimized for change}.
\end{itemize}

\hypertarget{understand}{%
\chapter{Understandable}\label{understand}}

It is crucial that we write code in a way that can be understood easily by others (and our future selves) and passed on to other staff with minimal additional instruction.

\hypertarget{structure2}{%
\section{Code structure}\label{structure2}}

There should be clear logical separation of parameters, assumptions, data and code, with appropriate documentation.

\hypertarget{data}{%
\subsection*{Data}\label{data}}
\addcontentsline{toc}{subsection}{Data}

\begin{itemize}
\item
  It should be easy for others to change parameters and data without needing to understand the full codebase.
\item
  Where possible, it's best practice to use lookup/reference files as much as possible, rather than hard-coding variables. An alternative approach is to store all parameters in one script, making it easy for the variables to be located and updated.
\item
  Small data files that are not MoJ data can be committed to the Github repo (e.g.~parameters, csvs containing assumptions, mock data for unit tests, lookup tables) - these should be stored in a `data' folder within the project folder.
\item
  Prefer text format (e.g.~csv) to Excel.
\item
  Please note that unpublished MoJ data should never be committed to your Github repository - even a `private' repo isn't secure. Instead, data should be stored in an \href{https://user-guidance.services.alpha.mojanalytics.xyz/amazon-s3.html\#amazon-s3-2}{S3 bucket} or in Athena.
\end{itemize}

\hypertarget{readme}{%
\subsection*{Documentation}\label{readme}}
\addcontentsline{toc}{subsection}{Documentation}

\begin{itemize}
\item
  Your project should include a README - by writing a README for your project you're helping others (and your future self) to understand and run your project. Find our template README \href{https://github.com/moj-analytical-services/our-coding-standards/blob/master/README_template.md}{here}.
\item
  You should add a description to your Github repository and tag it with appropriate \href{https://help.github.com/en/github/administering-a-repository/classifying-your-repository-with-topics}{topics}. This will allow your project to be discoverable and reusable by others. Github will also automatically tag it according to the \href{https://help.github.com/en/github/creating-cloning-and-archiving-repositories/about-repository-languages}{language} used.
\item
  Any functions you create should have \protect\hyperlink{functions}{appropriate documentation}.
\item
  Try to make your Git commit messages as informative as possible.
\item
  Your code should be appropriately commented. Comments are for explaining why something is needed, not how it works. Note that there are no hard and fast rules on how to do this - \href{https://blog.ndepend.com/correct-way-comment-code/}{this blog} gives an overview on some of the differing opinions on this.
\end{itemize}

\begin{quote}
Good code is its own best documentation. As you're about to add a comment, ask yourself, ``How can I improve the code so that this comment isn't needed?'' Improve the code and then document it to make it even clearer.'' - Steve McConnell
\end{quote}

\hypertarget{functions}{%
\subsection*{Abstractions}\label{functions}}
\addcontentsline{toc}{subsection}{Abstractions}

Abstractions (e.g.~functions, packages, modules etc.) should be used where possible. This makes code easier to understand, maintain and extend.

It will often be the case that will be a pre-existing package or module that contains the functions you need for your project. The best way to find these is usually through a quick google search and, if you're struggling to find what you're looking for, it's worth asking on the relevant slack channel (e.g. \href{https://app.slack.com/client/T1PU1AP6D/C1PUCG719}{\#r} and \href{https://app.slack.com/client/T1PU1AP6D/C1Q09V86S}{\#python} in the ASD workspace).

If you end up using a piece of code three times, it's probably worth turning it into a function and separating it out into a separate script. For more information on how to write functions, see \href{https://github.com/moj-analytical-services/writing_functions_in_r}{here}. As a general rule, functions should be less than about 50 lines long.

All non trivial functions should be documented using the programming language's accepted standard:\\
* For Python follow \href{https://www.python.org/dev/peps/pep-0008/}{PEP8} and particularly \href{https://www.python.org/dev/peps/pep-0257/}{PEP257}.\\
* For R, use \href{https://cran.r-project.org/web/packages/roxygen2/vignettes/roxygen2.html}{roxygen2}.

If your functions are short and well documented, there is often little need for additional code comments. See the \href{https://style.tidyverse.org/functions.html\#naming}{Tidyverse Style Guide} for some basic guidance on how to make your functions understandable.

\hypertarget{style}{%
\section{Code style}\label{style}}

There are often many ways of tackling a given problem. As a team, it makes sense to standardise our approach, not because one approach is necessarily better than all others, but because collaboration is easier if there is more commonality in our approaches.

\hypertarget{defaults}{%
\subsection*{Defaults}\label{defaults}}
\addcontentsline{toc}{subsection}{Defaults}

This section sets out sensible defaults which you are expected to follow. They are not strict rules, but you will be expected to explain the benefits of alternative approaches if you want to do something different.

\begin{longtable}[]{@{}ll@{}}
\toprule
\begin{minipage}[b]{0.27\columnwidth}\raggedright
Language\strut
\end{minipage} & \begin{minipage}[b]{0.67\columnwidth}\raggedright
Defaults\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.27\columnwidth}\raggedright
R\strut
\end{minipage} & \begin{minipage}[t]{0.67\columnwidth}\raggedright
\begin{itemize}
\tightlist
\item
  Follow the \href{https://style.tidyverse.org/index.html}{Tidyverse Style Guide}
\item
  Default to packages from the \href{http://tidyverse.org/}{Tidyverse}, because they have been carefully designed to work together effectively as part of a modern data analysis workflow. More info can be found here: \href{http://r4ds.had.co.nz}{R for Data Science by Hadley Wickham}. For example:

  \begin{itemize}
  \tightlist
  \item
    Prefer tibbles to data.frames
  \item
    Use ggplot2 rather than base graphics
  \item
    Use the pipe \texttt{\%\textgreater{}\%} appropriately, but not always e.g.~see \href{https://twitter.com/hadleywickham/status/603883121197514752}{here}.
  \item
    Prefer \texttt{purrr} to the \texttt{apply} family of functions. See \href{http://r4ds.had.co.nz/iteration.html\#the-map-functions}{here}
  \end{itemize}
\item
  Use the package name when calling a function. For example, using dplyr::mutate() rather than just mutate()
\item
  R Packages are the \href{http://r-pkgs.had.co.nz/}{fundamental unit of reproducible R code.}
\end{itemize}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.27\columnwidth}\raggedright
Python\strut
\end{minipage} & \begin{minipage}[t]{0.67\columnwidth}\raggedright
\begin{itemize}
\tightlist
\item
  Follow \href{https://www.python.org/dev/peps/pep-0008/}{PEP8}
\item
  Use Python 3
\item
  Use pandas for data analysis
\item
  Use \texttt{loc} and \texttt{iloc} to write to data frames
\item
  Use Altair for basic data visualisation
\item
  Use Scikit Learn for machine learning
\item
  Use SQLAlchemy and pandas for database interactions, rather than writing your own SQL
\end{itemize}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.27\columnwidth}\raggedright
Encoding and CSVs\strut
\end{minipage} & \begin{minipage}[t]{0.67\columnwidth}\raggedright
Use unicode. This means you should convert inputs that include non-ASCII characters to unicode as early as possible in your data processing workflow. If you are outputting to text files, these should be encoded in utf-8.\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.27\columnwidth}\raggedright
SQL\strut
\end{minipage} & \begin{minipage}[t]{0.67\columnwidth}\raggedright
Use Postgres or SQLite where possible, rather than other SQL database backends.\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.27\columnwidth}\raggedright
GIS\strut
\end{minipage} & \begin{minipage}[t]{0.67\columnwidth}\raggedright
\begin{itemize}
\tightlist
\item
  Use PostGIS as your GIS backend
\item
  Prefer conducting your GIS analysis in code, e.g.~using SQL, rather than point and click in a GUI
\item
  Use QGIS if you need a GUI.
\end{itemize}\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

In addition to the above coding defaults, the following actions will help you to write understandable code.

\hypertarget{names}{%
\subsection*{Naming conventions}\label{names}}
\addcontentsline{toc}{subsection}{Naming conventions}

\begin{itemize}
\tightlist
\item
  Use meaningful names - well-named functions and variables can remove the need for a comment and make life a little easier for other readers, including your future self. Avoid meaningless names like `obj' / `result' / `foo'.\\
\item
  Don't be cute or jokey when naming things.
\item
  Use single-letter variables only where the letter represents a well-known mathematical property (e.g.~e = mc\^{}2), or where their meaning is otherwise clear.
\end{itemize}

\hypertarget{ccc}{%
\subsection*{Clear and concise code}\label{ccc}}
\addcontentsline{toc}{subsection}{Clear and concise code}

\begin{itemize}
\tightlist
\item
  Choose clarity over cleverness - use advanced language tricks with care.
\item
  Avoid unnecessary repetition in you code. For example, if you end up using the same piece of code 3 times it's probably worth turning it into a function.\\
\item
  Less code is usually better - but not at the expense of clarity.\\
\item
  Use code comments well (see \protect\hyperlink{readme}{above}).
\end{itemize}

\hypertarget{linter}{%
\subsection*{Linters}\label{linter}}
\addcontentsline{toc}{subsection}{Linters}

A linter is a tool that analyses code to check for programmatic and stylistic errors. You should apply a linter to review your code formatting, which will mean our coding style will be consistent across projects and make it easier for others to understand.

In RStudio, the keyboard shortcut `ctrl+shift+A' will reformat your code and automate some of the process of passing the linter. If you apply the linter as you work, rather than at the end, you will find it much easier to write code that passes the linter first time.

\begin{itemize}
\tightlist
\item
  For R use \href{https://cran.r-project.org/web/packages/lintr/readme/README.html}{Lintr} and follow the \href{https://style.tidyverse.org/index.html}{Tidyverse Style Guide}.\\
\item
  For Python, use \href{http://pylint.pycqa.org/en/latest/}{pylint} and follow \href{https://www.python.org/dev/peps/pep-0008/}{PEP8}.
\end{itemize}

If possible, set up your linters and tests to run automatically on all pull requests, using \href{https://help.github.com/en/actions/automating-your-workflow-with-github-actions}{Github Actions}.

\hypertarget{errors}{%
\subsection*{Error messages}\label{errors}}
\addcontentsline{toc}{subsection}{Error messages}

Errors will occur, so write your error messages in a way that provide useful information to end users and people working on the code.

\hypertarget{accurate}{%
\chapter{Accurate}\label{accurate}}

Code should be error free and appropriately quality assured. Alongside simple sense-checking, two of the key mechanisms for ensuring that code is accurate are testing and project review.

\hypertarget{unittest}{%
\section{Testing}\label{unittest}}

Testing our code helps to ensure that it is both correct and robust. For further guidance on what you should test, see the \href{https://github.com/moj-analytical-services/coffee-and-coding-public/tree/master/2019-12-06\%20Testing\%20as\%20part\%20of\%20an\%20Analytical\%20Project}{Coffee and Coding `Testing' session}.

As a broad description, unit tests should exist to check that your actual results match your expected results.

Unit tests should test, as a minimum, any functions you create. The purpose of these granular tests is to ensure the code continues to give the correct answer in a range of cases, and even in edge cases (where unusual inputs are provided).

You should ensure that your tests and linters run automatically on all pull requests, using \href{https://help.github.com/en/actions/automating-your-workflow-with-github-actions}{Github Actions}.

There are a number of tools to enable unit testing:

\begin{longtable}[]{@{}ll@{}}
\toprule
\begin{minipage}[b]{0.21\columnwidth}\raggedright
Language\strut
\end{minipage} & \begin{minipage}[b]{0.73\columnwidth}\raggedright
Tools\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.21\columnwidth}\raggedright
R\strut
\end{minipage} & \begin{minipage}[t]{0.73\columnwidth}\raggedright
In R, consider using the \href{https://github.com/r-lib/testthat}{testthat} package. For an introduction to using testthat, try reading this \href{https://katherinemwood.github.io/post/testthat/}{blog post} from Inattentional Coffee or this \href{https://towardsdatascience.com/unit-testing-in-r-68ab9cc8d211}{Towards Data Science post}. For an example unit tests within a project, see \href{https://github.com/RobinL/costmodelr/tree/master/tests}{here}.\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.21\columnwidth}\raggedright
Python\strut
\end{minipage} & \begin{minipage}[t]{0.73\columnwidth}\raggedright
Consider using \href{https://docs.python.org/3/library/unittest.html}{unittest} or \href{https://docs.pytest.org/en/latest/}{pytest}.\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.21\columnwidth}\raggedright
Javascript\strut
\end{minipage} & \begin{minipage}[t]{0.73\columnwidth}\raggedright
See \href{http://busypeoples.github.io/post/testing-d3-with-jasmine/}{here} for testing with javascript. For data vis in Javascript, you need unit tests of routines that manipulate your data or data structures. Visual checks are sufficient of visualisation outputs, but you must make visual checks of the output against real data, and some test datasets that produce predictable output (e.g.~where values are set to 1, 0.5 etc.).\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{review}{%
\section{Project review}\label{review}}

Code review provides additional assurance that code logic is correct, as well as providing feedback on code and problem structuring. For smaller projects, the review only needs to be a simple read-through and sanity check.

Code reviews should be initiated through the creation of a \protect\hyperlink{flow}{pull request}. The review should typically involve the reviewer pulling the code to their local machine, testing it, and leaving comments in the pull request.

Remember that it's always easier (for both you and your reviewers) if you commit and push your changes regularly. You should merge branches into the master regularly so that reviewers review little and often, rather than attempting to review your entire codebase all at once.

\hypertarget{performing-good-peer-review}{%
\subsection*{Performing good peer review}\label{performing-good-peer-review}}
\addcontentsline{toc}{subsection}{Performing good peer review}

When performing peer review, asking yourself the following questions is a good place to start:

1: Do I understand what the code is doing? \protect\hyperlink{ccc}{Did it need to be explained} to me? \protect\hyperlink{ccc}{Could it be simpler}?

2: Are they using \protect\hyperlink{defaults}{packages / libraries sensibly}?

3: Does it need to be \protect\hyperlink{unittest}{tested} (and is it tested with sufficient coverage)?

4: Does it work? \protect\hyperlink{projdep}{Does it work on my machine?}

5: Are there any cases that might \protect\hyperlink{unittest}{break} it?

6: Is there sufficient \protect\hyperlink{readme}{documentation}?

7: Have they adopted an understandable \protect\hyperlink{style}{coding style}?

If you're reviewing the code of a more experienced coder, it is a chance to learn and you have every right to ask for an explanation if there's something that is unclear. It's in everyone's interest that you understand what you're reading and it could be that you don't understand it because the author has made a mistake or over-complicated something.

\hypertarget{collaborate}{%
\chapter{Collaborative}\label{collaborate}}

It is vital that we're able to collaborate across projects, to share both workload and expertise, and that this collaboration is possible both simultaneously and over time.

\hypertarget{versioncontrol}{%
\section{Version control}\label{versioncontrol}}

Code should be version controlled using Git and checked into Github.
You can find a guide to using Git with R \href{http://happygitwithr.com/}{here}. Within DASD we follow Github flow for our projects.

\hypertarget{flow}{%
\subsection*{Github flow}\label{flow}}
\addcontentsline{toc}{subsection}{Github flow}

Github flow is a working practice that helps to maintain overall code quality, facilitate collaboration on a single project and protect the codebase. We have tweaked it a little from what is \href{https://guides.github.com/introduction/flow/}{described on GitHub}.

There are 6 steps to our process:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Create or clone a repo.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{For}\NormalTok{ example, to clone this repo.}
\FunctionTok{git}\NormalTok{ clone git@github.com:moj-analytical-services/our-coding-standards.git}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\item
  Create an issue in Github that describes what you're working on
  To create an issue, use \href{https://guides.github.com/features/issues/}{the Github website}.
\item
  Create a new branch for the work you're about to do, with a name corresponding to the issue
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{To}\NormalTok{ create a new branch and switch onto it.}
\FunctionTok{git}\NormalTok{ checkout -b my-new-sensibly-named-branch}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Make some commits on the new branch.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{Make}\NormalTok{ some changes then stage each file you have changed - e.g. file1.txt and file2.txt.}
\FunctionTok{git}\NormalTok{ add file1.txt}
\FunctionTok{git}\NormalTok{ add file2.txt}
\ExtensionTok{etc}

\ExtensionTok{Commit}\NormalTok{ your changes using a descriptive commit message.}
\FunctionTok{git}\NormalTok{ commit}

\ExtensionTok{This}\NormalTok{ will take you into your default text editor}
\ExtensionTok{Write}\NormalTok{ a descriptive commit message}
\end{Highlighting}
\end{Shaded}

\begin{quote}
\textbf{Note:}
If you have not configured your text editor, you may get stuck in Vim. You can exit using the following command: \texttt{:q!}. Then configure your default text editor for Git
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{git}\NormalTok{ config --global core.editor }\OperatorTok{<}\NormalTok{my-favourite-text-editor}\OperatorTok{>}
 \ExtensionTok{Then}\NormalTok{ try again}
\FunctionTok{git}\NormalTok{ commit}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  When you're ready, submit a pull request and wait for peer-review.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{push}\NormalTok{ your branch to the remote repo}
\FunctionTok{git}\NormalTok{ push origin my-new-sensibly-named-branch}
\KeywordTok{then} \ExtensionTok{go}\NormalTok{ to Github, open a PR and invite at least one reviewer}
\end{Highlighting}
\end{Shaded}

Make sure that you reference the issue in your pull request, by using the hash (\#) symbol - see \href{https://help.github.com/articles/autolinked-references-and-urls/}{here} for further guidance. This makes it easy in future to see what changes were made to the code in response to the issue.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\item
  To make further changes, just make more commits on the same branch and push them to the remote repo again.
\item
  Once peer review is complete, and any comments addressed, merge into the master branch using a \href{https://github.com/blog/2243-rebase-and-merge-pull-requests}{rebase}.
\item
  The version of master on Github is now ahead of the version of master on your local machine. Bring your local version up to date using \texttt{git\ checkout\ master}, \texttt{git\ pull}. You are now in sync with Github, and ready to start a new branch.
\end{enumerate}

The master branch should be 100\% functional at all times, on any machine. Please ensure it is \href{https://help.github.com/articles/about-protected-branches/}{protected} and that your tests and linters \href{https://help.github.com/en/actions/automating-your-workflow-with-github-actions}{run automatically on all pull requests}. A protected master branch guarantees that all pull requests have been reviewed before they are merged.

For some further reading suggest this \href{https://gist.github.com/blackfalcon/8428401}{article} that explains these git commands and others in a bit more detail.

\hypertarget{gitlink}{%
\subsection*{Useful Github links}\label{gitlink}}
\addcontentsline{toc}{subsection}{Useful Github links}

\begin{itemize}
\tightlist
\item
  \href{https://jennybc.github.io/2014-05-12-ubc/ubc-r/session2.4_github.html}{A guide to getting started with github}\\
\item
  Github guide on \href{https://user-guidance.services.alpha.mojanalytics.xyz/github.html\#creating-your-project-repo-on-github}{analytical platform guidance}\\
\item
  List of basic \href{https://guides.github.com/introduction/git-handbook/}{git commands}
\end{itemize}

\hypertarget{knowledge}{%
\section{Share the knowledge}\label{knowledge}}

We also collaborate through sharing knowledge. There are a number of channels through which coding knowledge is shared in DASD:

\begin{itemize}
\tightlist
\item
  Slack channels (key channels are: \href{https://app.slack.com/client/T1PU1AP6D/C1Z8Q18LS}{\#data\_science}, \href{https://app.slack.com/client/T1PU1AP6D/C1PUCG719}{\#r}, \href{https://app.slack.com/client/T1PU1AP6D/C1Q09V86S}{\#python}, \href{https://app.slack.com/client/T1PU1AP6D/CSP8603CK}{\#conda})\\
\item
  Coffee and Coding (resources \href{https://github.com/moj-analytical-services/Coffee-and-Coding}{here})\\
\item
  \href{https://trello.com/b/zAwm6sCc/dasd-training}{DASD training Trello}\\
\item
  \href{https://docs.google.com/document/d/1R4hBMf26T9HEnCdVz56PpZhwiCv5RhberYL3BxOSKsA/edit}{R learning resources}
\end{itemize}

Further resources can be found \protect\hyperlink{ksresources}{here}.

\hypertarget{reproduce}{%
\chapter{Reproducible}\label{reproduce}}

We want our code to be reproducible so that:

\begin{itemize}
\tightlist
\item
  it can be used by others (both for collaboration and to allow effective review and accountability);\\
\item
  it keeps working over time (protected from external changes);
\item
  it can be easily reused by others in their own projects.
\end{itemize}

There are a number of steps that we can take to ensure that our code is as reproducible as possible.

\hypertarget{projdep}{%
\section{Manage project dependencies}\label{projdep}}

Your project will depend on an number of external factors, such as software or packages. These dependencies may mean that your project won't work on others' machines or may not work on your machine at a later date (e.g.~as external packages are updated over time). To ensure that this doesn't become an issue for your project, you should use some kind of dependency management tool.

\hypertarget{dependency-management-tools}{%
\subsection*{Dependency management tools}\label{dependency-management-tools}}
\addcontentsline{toc}{subsection}{Dependency management tools}

\begin{longtable}[]{@{}ll@{}}
\toprule
\begin{minipage}[b]{0.20\columnwidth}\raggedright
Language\strut
\end{minipage} & \begin{minipage}[b]{0.74\columnwidth}\raggedright
Tools\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.20\columnwidth}\raggedright
R\strut
\end{minipage} & \begin{minipage}[t]{0.74\columnwidth}\raggedright
We recommend using \href{https://user-guidance.services.alpha.mojanalytics.xyz/appendix/conda/\#content}{Conda}. Other alternatives are \href{https://rstudio.github.io/packrat/}{Packrat} and \href{https://blog.rstudio.com/2019/11/06/renv-project-environments-for-r/}{Renv}.\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\raggedright
Python\strut
\end{minipage} & \begin{minipage}[t]{0.74\columnwidth}\raggedright
We recommend using \href{https://user-guidance.services.alpha.mojanalytics.xyz/appendix/conda/\#content}{Conda}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\raggedright
Javascript\strut
\end{minipage} & \begin{minipage}[t]{0.74\columnwidth}\raggedright
Include third party library dependencies in the project as \texttt{.js} files\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{githash}{%
\subsection*{Include a git hash}\label{githash}}
\addcontentsline{toc}{subsection}{Include a git hash}

If practical, the output of your code should include the git hash of the code that produced it. By doing so, the analysis should be
more reproducible, there is no ambiguity about the specific code that was used to generate it.

\hypertarget{r}{%
\subsubsection*{R}\label{r}}
\addcontentsline{toc}{subsubsection}{R}

You can access the git hash using either of the following code:
snippets.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(git2r)}
\NormalTok{repo <-}\StringTok{ }\KeywordTok{repository}\NormalTok{(}\StringTok{"."}\NormalTok{)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{repository_head}\NormalTok{(repo))}
\end{Highlighting}
\end{Shaded}

or

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{system}\NormalTok{(}\StringTok{"git rev-parse --short HEAD"}\NormalTok{, }\DataTypeTok{intern =} \OtherTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{python}{%
\subsubsection*{Python}\label{python}}
\addcontentsline{toc}{subsubsection}{Python}

You can access the git hash using the following code:

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ subprocess}
\KeywordTok{def}\NormalTok{ get_git_revision_hash():}
    \ControlFlowTok{return}\NormalTok{ subprocess.check_output([}\StringTok{'git'}\NormalTok{, }\StringTok{'rev-parse'}\NormalTok{, }\StringTok{'HEAD'}\NormalTok{])}
\KeywordTok{def}\NormalTok{ get_git_revision_short_hash():}
    \ControlFlowTok{return}\NormalTok{ subprocess.check_output([}\StringTok{'git'}\NormalTok{, }\StringTok{'rev-parse'}\NormalTok{, }\StringTok{'--short'}\NormalTok{, }\StringTok{'HEAD'}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\hypertarget{format}{%
\section{Format}\label{format}}

If the output is a report, the write up should be fully reproducible, or as close as possible.

\begin{itemize}
\tightlist
\item
  Avoid workflows that require manually copying and pasting results between documents.\\
\item
  For Python, consider using Jupyter notebooks. For R, use \texttt{rmarkdown}.
\end{itemize}

\hypertarget{change}{%
\section{Optimize for change}\label{change}}

\begin{itemize}
\tightlist
\item
  Don't try to solve every conceivable problem up-front, instead focus on making your code easy to change when needed.
\item
  Don't prematurely optimize - choose clarity over performance, unless there is a serious performance issue that needs to be addressed.
\item
  Change can come in several forms, including hardware - your code will eventually be run on a colleague's machine or a server somewhere. Without over-complicating things, write your code with this in mind. For example, use relative paths (e.g. \texttt{./file\_in\_the\_project\_directory.R} rather than \texttt{/Users/my\_username/development/my\_project/file\_in\_the\_project\_directory.R})
\end{itemize}

\hypertarget{resources}{%
\part{Resources}\label{resources}}

\hypertarget{wf}{%
\chapter{Workflow}\label{wf}}

The following is the recommended workflow for coding projects in DASD. It has been included here to aid understanding of how the coding principles fit into the project life-cycle. For more detail on how to complete the Git steps, please read the section on \protect\hyperlink{flow}{Github flow}.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{Create/clone \protect\hyperlink{versioncontrol}{Github repo}}\\
\end{enumerate}

\begin{itemize}
\tightlist
\item
  By storing your code in a repo you're making it easier for others to collaborate on your project and to use pieces of your code elsewhere, as well as ensuring that your project will be accessible in the future.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  \textbf{Create \protect\hyperlink{versioncontrol}{issue}}\\
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Using issues to communicate what you're working on helps to coordinate tasks between team members, creates a record of completed work and is useful for quality assurance purposes.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  \textbf{Create \protect\hyperlink{versioncontrol}{branch}}\\
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Creating a branch means that several people can work on a project simultaneously and protects the main codebase from any unwanted changes.\\
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  \textbf{Set up \protect\hyperlink{projdep}{dependency management}}\\
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Managing your project dependencies means that your project is more likely to be re-runnable in the future and on others' machines.\\
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  \textbf{Build in \protect\hyperlink{unittest}{unit testing}}\\
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Unit tests provide confidence that your code is correct and can be used to pinpoint issues where they occur, making fixes quicker and easier.\\
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  \textbf{Commit \protect\hyperlink{versioncontrol}{changes}}\\
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Committing your changes means that you can recover your work if you make a mistake and provides a record of changes for your reviewer.\\
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  \textbf{\protect\hyperlink{review}{Pull request and code review}}\\
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Ensuring that your code is reviewed provides both confidence in the accuracy of your code and the opportunity to share knowledge with colleagues.
\end{itemize}

\hypertarget{checklist}{%
\chapter{Project Checklist}\label{checklist}}

In the same spirit as the coding principles, the checklist below has been designed to help you achieve `best practice' in your project. Please note that the features listed below are recommendations and are not compulsory.

\begin{itemize}
\tightlist
\item
  {[} {]} Project follows the \protect\hyperlink{versioncontrol}{Github workflow}
\item
  {[} {]} Project repo has a description and is \protect\hyperlink{readme}{tagged with topics}
\item
  {[} {]} Project repo contains a populated \protect\hyperlink{readme}{README}
\item
  {[} {]} Project \protect\hyperlink{projdep}{dependencies} are managed
\item
  {[} {]} \protect\hyperlink{style}{Sensible defaults} have been used within the code
\item
  {[} {]} A \protect\hyperlink{style}{linter} has been applied to the code
\item
  {[} {]} Functions are \protect\hyperlink{functions}{documented}
\item
  {[} {]} Project contains \protect\hyperlink{unittest}{unit tests}
\item
  {[} {]} Tests and linters \protect\hyperlink{unittest}{run automatically} on pull requests
\item
  {[} {]} All code has been \protect\hyperlink{review}{reviewed} by another person
\end{itemize}

\hypertarget{ksresources}{%
\chapter{Knowledge Share Resources}\label{ksresources}}

There are a number of channels through which coding knowledge is shared in DASD:

\begin{itemize}
\tightlist
\item
  Slack channels (key channels are: \href{https://app.slack.com/client/T1PU1AP6D/C1Z8Q18LS}{\#data\_science}, \href{https://app.slack.com/client/T1PU1AP6D/C1PUCG719}{\#r}, \href{https://app.slack.com/client/T1PU1AP6D/C1Q09V86S}{\#python}, \href{https://app.slack.com/client/T1PU1AP6D/CSP8603CK}{\#conda})\\
\item
  Coffee and Coding (resources \href{https://github.com/moj-analytical-services/Coffee-and-Coding}{here})\\
\item
  \href{https://trello.com/b/zAwm6sCc/dasd-training}{DASD training Trello}\\
\item
  \href{https://docs.google.com/document/d/1R4hBMf26T9HEnCdVz56PpZhwiCv5RhberYL3BxOSKsA/edit}{R learning resources}\\
\item
  \href{https://trello.com/b/D5pSkqnT/online-analytical-training}{Online analytical training Trello}
\end{itemize}

\hypertarget{dev}{%
\part{Development}\label{dev}}

\hypertarget{futureadd}{%
\chapter{Future Additions}\label{futureadd}}

This section lists content that it would be helpful to add to this document in future. If you feel you are able to contribute to any of these areas, please clone this repo, make your changes on a branch and send a pull request for review.

\hypertarget{understandable}{%
\subsubsection*{Understandable}\label{understandable}}
\addcontentsline{toc}{subsubsection}{Understandable}

\begin{itemize}
\tightlist
\item
  Is there a different code structure for a Shiny App?
  For example can a shiny app be a package? Should most of the code be in a package and then a bare bones shiny app is made on top?\\
\item
  When would you use Python rather than R? Are there certain things that each are better for?\\
\item
  Template for project structure (in terms of folders etc.)
\end{itemize}

\hypertarget{accurate-1}{%
\subsubsection*{Accurate}\label{accurate-1}}
\addcontentsline{toc}{subsubsection}{Accurate}

\begin{itemize}
\tightlist
\item
  Example project where unit tests are set up and working.\\
\item
  Example project where linters and tests are set up to run automatically on pull requests (through Github Actions).
\end{itemize}

\hypertarget{collaborative}{%
\subsubsection*{Collaborative}\label{collaborative}}
\addcontentsline{toc}{subsubsection}{Collaborative}

\begin{itemize}
\tightlist
\item
  Notes on cross-team working
\end{itemize}

\hypertarget{reproducible}{%
\subsubsection*{Reproducible}\label{reproducible}}
\addcontentsline{toc}{subsubsection}{Reproducible}

\begin{itemize}
\tightlist
\item
  Example project with Conda set up for dependency management (and a few exercises for people to explore further).
\end{itemize}

\hypertarget{knowledge-share-resources}{%
\subsubsection*{Knowledge Share Resources}\label{knowledge-share-resources}}
\addcontentsline{toc}{subsubsection}{Knowledge Share Resources}

\begin{itemize}
\tightlist
\item
  Additional resources
\end{itemize}

\end{document}
