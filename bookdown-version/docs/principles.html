<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Coding Principles | DASD Coding Standards</title>
  <meta name="description" content="These are the DASD coding standards." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Coding Principles | DASD Coding Standards" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are the DASD coding standards." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Coding Principles | DASD Coding Standards" />
  
  <meta name="twitter:description" content="These are the DASD coding standards." />
  

<meta name="author" content="Data Science Hub" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="wf.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DASD Coding Standards</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Reviewer notes</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#motivation"><i class="fa fa-check"></i><b>2.1</b> Motivation</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#structure"><i class="fa fa-check"></i><b>2.2</b> Guidance structure</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#contributing"><i class="fa fa-check"></i><b>2.3</b> Contributing</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="principles.html"><a href="principles.html"><i class="fa fa-check"></i><b>3</b> Coding Principles</a><ul>
<li class="chapter" data-level="3.1" data-path="principles.html"><a href="principles.html#reproduce"><i class="fa fa-check"></i><b>3.1</b> Reproducibile</a><ul>
<li class="chapter" data-level="3.1.1" data-path="principles.html"><a href="principles.html#projdep"><i class="fa fa-check"></i><b>3.1.1</b> Manage project dependencies</a></li>
<li class="chapter" data-level="3.1.2" data-path="principles.html"><a href="principles.html#change"><i class="fa fa-check"></i><b>3.1.2</b> Optimize for change</a></li>
<li class="chapter" data-level="3.1.3" data-path="principles.html"><a href="principles.html#format"><i class="fa fa-check"></i><b>3.1.3</b> Format</a></li>
<li class="chapter" data-level="3.1.4" data-path="principles.html"><a href="principles.html#githash"><i class="fa fa-check"></i><b>3.1.4</b> Reproducing on another machine</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="principles.html"><a href="principles.html#collaborate"><i class="fa fa-check"></i><b>3.2</b> Collaborative</a><ul>
<li class="chapter" data-level="3.2.1" data-path="principles.html"><a href="principles.html#versioncontrol"><i class="fa fa-check"></i><b>3.2.1</b> Version Control</a></li>
<li class="chapter" data-level="3.2.2" data-path="principles.html"><a href="principles.html#knowledge"><i class="fa fa-check"></i><b>3.2.2</b> Share the knowledge</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="principles.html"><a href="principles.html#accurate"><i class="fa fa-check"></i><b>3.3</b> Accurate</a><ul>
<li class="chapter" data-level="3.3.1" data-path="principles.html"><a href="principles.html#review"><i class="fa fa-check"></i><b>3.3.1</b> Review</a></li>
<li class="chapter" data-level="3.3.2" data-path="principles.html"><a href="principles.html#unittest"><i class="fa fa-check"></i><b>3.3.2</b> Unit testing</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="principles.html"><a href="principles.html#understand"><i class="fa fa-check"></i><b>3.4</b> Understandable</a><ul>
<li class="chapter" data-level="3.4.1" data-path="principles.html"><a href="principles.html#readme"><i class="fa fa-check"></i><b>3.4.1</b> Documentation</a></li>
<li class="chapter" data-level="3.4.2" data-path="principles.html"><a href="principles.html#defaults"><i class="fa fa-check"></i><b>3.4.2</b> Use sensible defaults</a></li>
<li class="chapter" data-level="3.4.3" data-path="principles.html"><a href="principles.html#structure2"><i class="fa fa-check"></i><b>3.4.3</b> Code structure</a></li>
<li class="chapter" data-level="3.4.4" data-path="principles.html"><a href="principles.html#functions"><i class="fa fa-check"></i><b>3.4.4</b> Abstractions</a></li>
<li class="chapter" data-level="3.4.5" data-path="principles.html"><a href="principles.html#style"><i class="fa fa-check"></i><b>3.4.5</b> Coding style</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="wf.html"><a href="wf.html"><i class="fa fa-check"></i><b>4</b> Workflow</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DASD Coding Standards</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="principles" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Coding Principles</h1>
<p>The following coding principles have been developed to help achieve the following objectives. (I) Ensure we write high quality, maintainable, code; (II) Where possible, ensure our work is reusable; and (III) Collaborate with one another effectively accross multiple projects.</p>
<p>Code should be:</p>
<p><strong>1. <a href="principles.html#reproduce">Reproducible</a></strong></p>
<ul>
<li>Manage <a href="principles.html#projdep">project dependencies</a></li>
<li>Optimise for <a href="principles.html#change">change</a><br />
</li>
<li>Analyses should be <a href="principles.html#githash">simple and easy to reproduce</a> on another machine.</li>
</ul>
<p><strong>2. <a href="principles.html#collaborate">Collaborative</a></strong></p>
<ul>
<li>Use the <a href="principles.html#versioncontrol">github workflow</a> across all projects<br />
</li>
<li><a href="principles.html#knowledge">Share</a> the knowledge</li>
</ul>
<p><strong>3. <a href="principles.html#accurate">Accurate</a></strong></p>
<ul>
<li>Ensure code is <a href="principles.html#review">reviewed</a></li>
<li>Complete <a href="principles.html#unittest">unit testing</a></li>
</ul>
<p><strong>4. <a href="principles.html#understand">Understandable</a></strong></p>
<ul>
<li>Write a <a href="principles.html#readme">README</a> for your project<br />
</li>
<li>Use <a href="principles.html#defaults">sensible defaults</a> unless you have a great reason not to</li>
<li>Write <a href="principles.html#functions">functions</a> where needed<br />
</li>
<li><a href="principles.html#style">Stylistic</a>:
<ul>
<li>Apply a <a href="principles.html#linter">linter</a></li>
<li>Ensure <a href="principles.html#names">variable names</a> are meaningful</li>
<li>Code should be <a href="principles.html#ccc">correct, clear and concise</a></li>
<li><a href="principles.html#errors">Handle errors</a><br />
</li>
<li>Other team members <a href="principles.html#users">are users too</a> - treat them with respect</li>
</ul></li>
</ul>
<p>These ideas are stated in no particular order, and are <em>always</em> open to debate. In fact, you are encouraged to contribute.</p>
<p>All development is a trade-off between competing pressures, these principles are meant to help you decide which trade-offs are acceptable.</p>
<p>They are guidance, not The Law - there will always be edge cases, but you should expect to be challenged if you go your own way.</p>

<div id="reproduce" class="section level2">
<h2><span class="header-section-number">3.1</span> Reproducibile</h2>
<div id="projdep" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Manage project dependencies</h3>
<p>Previously packrat was more widely used, but lots of people seem to use conda now.<br />
* <a href="https://github.com/moj-analytical-services/coffee-and-coding-public/blob/master/2019-10-30%20Conda/conda.pdf">Conda</a><br />
* <a href="https://rstudio.github.io/packrat/">Packrat</a><br />
* <a href="https://blog.rstudio.com/2019/11/06/renv-project-environments-for-r/">Renv</a></p>
</div>
<div id="change" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Optimize for change</h3>
<ul>
<li>Don’t try to solve every conceivable problem up-front, instead focus on making your code easy to change when needed.</li>
<li>Don’t prematurely optimize - choose clarity over performance, unless there is a serious performance issue that needs to be addressed.</li>
<li>Change can come in several forms, including hardware - your code will eventually be run on a colleague’s machine or a server somewhere. Without overcomplicating things, write your code with this in mind. For example, use relative paths (e.g. <code>./file_in_the_project_directory.R</code> rather than <code>/Users/my_username/development/my_project/file_in_the_project_directory.R</code>)</li>
</ul>
</div>
<div id="format" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Format</h3>
<p>If the output is a report, the write up is fully reproducible, or as close as possible.
* Avoid workflows that require manually copying and pasting results between documents.<br />
* Your code should be <a href="https://github.com/moj-analytical-services/our-coding-standards/blob/master/correct_clear_concise.md">DRY</a><br />
* For Python, consider using Jupyter notebooks. For R, use <code>rmarkdown</code></p>
</div>
<div id="githash" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Reproducing on another machine</h3>
<p>Your project should be tested on someone else’s machine There may be software or other dependencies installed on your machine that mean the project doesn’t work on others’ machines.</p>
<p>Your dependencies are explicitly managed.
If your code depends on external packages, these change over time, and need to be enumerated. This guarantees that your code will work on others’ machines, and that it will work on your machine in a year’s time.
For Python, use a Virtual Environment
For R, use packrat
For javascript, include third party library dependencies in the project as <code>.js</code> files</p>
<div id="include-a-git-hash" class="section level4 unnumbered">
<h4>Include a git hash</h4>
<p>Some tips on making your analyses simple to reproduce</p>
<p>If practical, the output of your code should include the git hash
of the code that produced it. By doing so, the analysis should be
more reproducible, there is no ambiguity about the specific code
that was used to generate it.</p>
<div id="r" class="section level5 unnumbered">
<h5>R</h5>
<p>You can access the git hash using either of the following code:
snippets.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="principles.html#cb1-1"></a><span class="kw">library</span>(git2r)</span>
<span id="cb1-2"><a href="principles.html#cb1-2"></a></span>
<span id="cb1-3"><a href="principles.html#cb1-3"></a>repo &lt;-<span class="st"> </span><span class="kw">repository</span>(<span class="st">&quot;.&quot;</span>)</span>
<span id="cb1-4"><a href="principles.html#cb1-4"></a><span class="kw">print</span>(<span class="kw">head</span>(repo))</span></code></pre></div>
<pre><code>## Warning: &#39;head.git_repository&#39; is deprecated.
## Use &#39;repository_head&#39; instead.
## See help(&quot;Deprecated&quot;)</code></pre>
<pre><code>## [5aee5c] (Local) (HEAD) nikki-rewrite</code></pre>
<p>or</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="principles.html#cb4-1"></a><span class="kw">print</span>(<span class="kw">system</span>(<span class="st">&quot;git rev-parse --short HEAD&quot;</span>, <span class="dt">intern =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<pre><code>## [1] &quot;5aee5c7&quot;</code></pre>
</div>
<div id="python" class="section level5 unnumbered">
<h5>Python</h5>
<p>You can access the git hash using the following code:
```import subprocess</p>
<p>def get_git_revision_hash():
return subprocess.check_output([‘git’, ‘rev-parse’, ‘HEAD’])</p>
<p>def get_git_revision_short_hash():
return subprocess.check_output([‘git’, ‘rev-parse’, ‘–short’, ‘HEAD’])```</p>

</div>
</div>
</div>
</div>
<div id="collaborate" class="section level2">
<h2><span class="header-section-number">3.2</span> Collaborative</h2>
<div id="versioncontrol" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Version Control</h3>
<p>Code is version controlled using Git and checked into Github.
You can find a guide to using Git with R <a href="http://happygitwithr.com/">here</a>
You are able to maintain a continuously quality controlled ‘master’ version of the code, whilst also being able to test new features and functionality.</p>
<p>The ‘Master’ branch is protected, and contains only QAed code
When you create your git project using <code>git init</code>, immediately branch off to a development branch e.g. using <code>git checkout -b dev</code>, and work on this branch.<br />
Merge code into master using pull requests in github. A protected master branch guarantees that all pull requests have been reviewed before they are merged.</p>
<div id="github-flow-is-a-working-practice-that-helps-to" class="section level4 unnumbered">
<h4>Github-Flow is a working practice that helps to:</h4>
<ol style="list-style-type: decimal">
<li>Maintain overall code quality<br />
</li>
<li>Facilitate collaboration on a single project<br />
</li>
<li>Protect the codebase</li>
</ol>
<p>We have tweaked it a little from what is <a href="https://guides.github.com/introduction/flow/">described on GitHub</a></p>
</div>
<div id="there-are-6-steps-to-our-process" class="section level4 unnumbered">
<h4>There are 6 steps to our process:</h4>
<ol style="list-style-type: decimal">
<li>Create or clone a repo.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="principles.html#cb6-1"></a><span class="co"># For example, to clone this repo.</span></span>
<span id="cb6-2"><a href="principles.html#cb6-2"></a><span class="fu">git</span> clone git@github.com:moj-analytical-services/our-coding-standards.git</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><p>Create an issue in Github that describes what you’re working on
To create an issue, use <a href="https://guides.github.com/features/issues/">the Github website</a>.</p></li>
<li><p>Create a new branch for the work you’re about to do, with a name corresponding to the issue</p></li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="principles.html#cb7-1"></a><span class="co"># To create a new branch and switch onto it.</span></span>
<span id="cb7-2"><a href="principles.html#cb7-2"></a><span class="fu">git</span> checkout -b my-new-sensibly-named-branch</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Make some commits on the new branch.</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="principles.html#cb8-1"></a><span class="co"># Make some changes then stage each file you&#39;ve changed - e.g. file1.txt and file2.txt.</span></span>
<span id="cb8-2"><a href="principles.html#cb8-2"></a><span class="fu">git</span> add file1.txt</span>
<span id="cb8-3"><a href="principles.html#cb8-3"></a><span class="fu">git</span> add file2.txt</span>
<span id="cb8-4"><a href="principles.html#cb8-4"></a><span class="co"># etc</span></span>
<span id="cb8-5"><a href="principles.html#cb8-5"></a></span>
<span id="cb8-6"><a href="principles.html#cb8-6"></a><span class="co"># Commit your changes using a descriptive commit message.</span></span>
<span id="cb8-7"><a href="principles.html#cb8-7"></a><span class="fu">git</span> commit</span>
<span id="cb8-8"><a href="principles.html#cb8-8"></a></span>
<span id="cb8-9"><a href="principles.html#cb8-9"></a><span class="co"># This will take you into your default text editor</span></span>
<span id="cb8-10"><a href="principles.html#cb8-10"></a><span class="co"># Write a descriptive commit message</span></span></code></pre></div>
<blockquote>
<p><strong>Note:</strong>
If you have not configured your text editor, you may get stuck in Vim. You can exit using the following command: <code>:q!</code>. Then configure your default text editor for Git</p>
</blockquote>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="principles.html#cb9-1"></a><span class="fu">git</span> config --global core.editor <span class="op">&lt;</span>my-favourite-text-editor<span class="op">&gt;</span></span>
<span id="cb9-2"><a href="principles.html#cb9-2"></a> <span class="co"># Then try again</span></span>
<span id="cb9-3"><a href="principles.html#cb9-3"></a><span class="fu">git</span> commit</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>When you’re ready, submit a pull request and wait for peer-review.</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="principles.html#cb10-1"></a><span class="co"># push your branch to the remote repo</span></span>
<span id="cb10-2"><a href="principles.html#cb10-2"></a><span class="fu">git</span> push origin my-new-sensibly-named-branch</span>
<span id="cb10-3"><a href="principles.html#cb10-3"></a><span class="co"># then go to github, open a PR and invite at least one reviewer</span></span></code></pre></div>
<p>Make sure that you reference the issue in your pull request, by using the hash (#) symbol - see <a href="https://help.github.com/articles/autolinked-references-and-urls/">here</a> for further guidance. This makes it easy in future to see what changes were made to the code in response to the issue.</p>
<ol start="6" style="list-style-type: decimal">
<li><p>To make further changes, just make more commits on the same branch and push them to the remote repo again.</p></li>
<li><p>Once peer review is complete, and any comments addressed, merge into the master branch using a <a href="https://github.com/blog/2243-rebase-and-merge-pull-requests">rebase</a>.</p></li>
<li><p>The version of master on Github is now ahead of the version of master on your local machine. Bring your local version up to date using <code>git checkout master</code>, <code>git pull</code>. You are now in sync with Github, and ready to start a new branch.</p></li>
</ol>
<p>The <strong>master branch should be 100% functional at all times</strong>, on any machine. Please ensure it is <a href="https://help.github.com/articles/about-protected-branches/">protected</a> and that your tests and / or linters run automatically on all pull requests.</p>
<p>For some further reading we strongly suggest reading this <a href="https://gist.github.com/blackfalcon/8428401">article</a> that explains these git commands and others in a bit more detail.</p>
<p>If you want to test this out, clone this repo and make a contribution :)</p>
</div>
<div id="gitlink" class="section level4 unnumbered">
<h4>Useful links for using github</h4>
<ul>
<li><a href="https://jennybc.github.io/2014-05-12-ubc/ubc-r/session2.4_github.html">A guide to getting started with github</a><br />
</li>
<li>Github guide on <a href="https://user-guidance.services.alpha.mojanalytics.xyz/github.html#creating-your-project-repo-on-github">analytical platform guidance</a><br />
</li>
<li>List of basic <a href="https://guides.github.com/introduction/git-handbook/">git commands</a></li>
</ul>
</div>
</div>
<div id="knowledge" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Share the knowledge</h3>
<p>If you have knowledge which is unique to you, it is your responsibility to share it.
We follow “github flow”, to keep branches small and short-lived, and ensure knowledge is shared.
You could also present your work at Display DaSH.
If you produce something reusable, package it &amp; share it with others.
All non-throwaway code should be reviewed - no-one is 100% right, 100% of the time.
Be aware that ‘throwaway’ code has a nasty habit of somehow ending up in completed products.</p>

</div>
</div>
<div id="accurate" class="section level2">
<h2><span class="header-section-number">3.3</span> Accurate</h2>
<div id="review" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Review</h3>
<p>Ensure that code is reviewed: initiate this through a pull request. Remember that it’s always easier (for both you and your reviewers) if you commit and push your changes regularly.</p>
<p>All code has been subject to code review.<br />
For smaller projects, this is a simple read-through and sanity check You should merge branches into master regularly so that reviewers review little and often, rather than attempting to review your entire codebase all at once.
Code review provides additional assurance that code logic is correct, and also the review should provide comments on code and problem structuring.</p>
<p>All code has been subject to code review.
This process has been managed through pull requests, and this evidenced in Github. This should typically involve the reviewer pulling the code to their local machine, testing it, and leaving comments in the pull request.
You should merge branches into master regularly so that reviewers review little and often, rather than attempting to review your entire codebase all at once.
Code review provides additional assurance that code logic is correct, and also the review should provide comments on code and problem structuring.</p>
<div id="performing-good-peer-review" class="section level4 unnumbered">
<h4>Performing good peer review</h4>
<p>When you review someone’s pull request you become the gatekeeper to the master branch - this is a <em>very</em> important job! If you’re tasked with this and you’re wondering how to proceed asking yourself these questions is a good place to start…</p>
<p>1: Do I understand what the code is doing? <a href="principles.html#users">Did it need to be explained</a> to me? <a href="principles.html#ccc">Could it be simpler</a>?</p>
<p>2: Are they using <a href="principles.html#defaults">packages / libraries sensibly</a>?</p>
<p>3: Does it need to be <a href="principles.html#ccc">tested</a> (and is it tested with sufficient coverage)?</p>
<p>4: <a href="principles.html#ccc">Does it work</a>? Does it work on my machine?</p>
<p>5: Are there edge cases that might <a href="principles.html#errors">break The Thing</a>?</p>
<p>If you’re reviewing the code of a more experienced coder, this is <strong>a chance to learn</strong> and you have <em>every</em> right to ask for an explanation if there’s something that is unclear. It’s in everyone’s interest that you understand what you’re reading and it could well be that you don’t yet understand it because the author has made a mistake or overcomplicated something. So <em>don’t hold back</em>.</p>
<p>If you’re on the receiving end of feedback, from anyone at all, this is… <strong>a chance to learn!</strong> :)</p>
</div>
</div>
<div id="unittest" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Unit testing</h3>
<p>Use testthat and shinytest for unit testing. The following might be helpful:<br />
* Nice <a href="https://katherinemwood.github.io/post/testthat/">intro to using testthat</a><br />
* Another <a href="https://towardsdatascience.com/unit-testing-in-r-68ab9cc8d211">intro to testthat</a><br />
* <a href="https://github.com/RobinL/costmodelr/tree/master/tests">Example of using testthat</a></p>
<p>Unit tests exist that test the overall codebase, but not individual functions.
Unit tests help give you confidence that your model does what you think it does
There are various approaches to unit testing in Python. Consider using <a href="https://docs.python.org/3/library/unittest.html">unittest</a> in the Python core library. Another option is <a href="https://docs.pytest.org/en/latest/">pytest</a>. See also <a href="http://python-guide-pt-br.readthedocs.io/en/latest/writing/tests/">here</a>
In R, you should use the <a href="https://github.com/hadley/testthat">testthat</a> package for unit testing.<br />
You can find examples of how to do unit testing <a href="https://github.com/ukgovdatascience/eesectors/tree/master/tests">here</a> and <a href="https://github.com/RobinL/costmodelr/tree/master/tests">here</a> See <a href="http://busypeoples.github.io/post/testing-d3-with-jasmine/">here</a> for testing with javascript</p>
<p>Unit tests exist at the function level, which test a range of parameters.<br />
The purpose of these granular tests is to ensure the code continues to give the correct answer ion a range of cases, and even in edge cases (where unusual inputs are provided).
For data vis in Javascript, you need unit tests of routines that manipulate your data or data structures. Visual checks are sufficient of visualisation outputs, but you must make visual checks of the output against real data, and some test datasets that produce predictable output (e.g. where values are set to 1, 0.5 etc.)</p>

</div>
</div>
<div id="understand" class="section level2">
<h2><span class="header-section-number">3.4</span> Understandable</h2>
<div id="readme" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Documentation</h3>
<p>Include a README</p>
<p>By writing a README for your project you’re helping others (and your future self) to be able to understand and run your project. Find our template README <a href="https://github.com/moj-analytical-services/our-coding-standards/blob/master/README_template.md">here</a>.</p>
<p>You have added a description to your Github repository and tagged it with appropriate tags This will allow your project to be discoverable and reusable by others.</p>
</div>
<div id="defaults" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Use sensible defaults</h3>
<p>There are often many ways of tackling a given problem. As a team, it makes sense to standardise our approach, not because one approach is necessarily better than all others, but because collaboration is easier if there is less diversity in our approaches.</p>
<p>This section sets out sensible defaults which you are expected to follow. They are not strict rules, but you will be expected to explain the benefits of alternative approaches if you want to do something different.</p>
<div id="general" class="section level4 unnumbered">
<h4>General</h4>
<ul>
<li>You should target <a href="http://vita.had.co.nz/papers/tidy-data.html">tidy</a> data structures as part of your work. You should attempt to convert incoming data into tidy format as quickly as possible, and any data that is output that may be used in other projects should be in tidy format.</li>
<li>If there is a standardised directory structure for your type of project, using it will help people find things. [TODO: Add examples]</li>
</ul>
<p>You have used the <a href="https://github.com/moj-analytical-services/our-coding-standards/blob/master/sensible_defaults.md">sensible defaults</a>, unless you have a good reason not to and have agreed this with your line manager
There are often many ways of tackling a given problem. As a team, it makes sense to standardise our approach, not because one approach is necessarily better than all others, but because collaboration is easier if there is less diversity in our approaches.</p>
</div>
<div id="r-1" class="section level4 unnumbered">
<h4>R</h4>
<ul>
<li>Default to packages from the <a href="http://tidyverse.org/">Tidyverse</a>, because they have been carefully designed to work together effectively as part of a modern data analysis workflow. More info can be found here: <a href="http://r4ds.had.co.nz">R for Data Science by Hadley Wickham</a>. For example:
<ul>
<li>Prefer tibbles to data.frames</li>
<li>Use ggplot2 rather than base graphics</li>
<li>Use the pipe <code>%&gt;%</code> appropriately, but not always e.g. see <a href="https://twitter.com/hadleywickham/status/603883121197514752">here</a>.<br />
</li>
<li>Prefer <code>purrr</code> to the <code>apply</code> family of functions. See <a href="http://r4ds.had.co.nz/iteration.html#the-map-functions">here</a></li>
</ul></li>
<li>Use <a href="https://rstudio.github.io/packrat/">Packrat</a> for R dependencies - it’s required by the Analytical Platform if you need to deploy your work.</li>
<li>R Packages are the <a href="http://r-pkgs.had.co.nz/">fundamental unit of reproducable R code.</a></li>
</ul>
</div>
<div id="python-1" class="section level4 unnumbered">
<h4>Python</h4>
<ul>
<li>Use Python 3</li>
<li>Use pandas for data analysis</li>
<li>Use <code>loc</code> and <code>iloc</code> to write to data frames</li>
<li>Use Altair for basic data visualisation</li>
<li>Use Scikit Learn for machine learning</li>
<li>Use SQLAlchemy and pandas for database interactions, rather than writing your own SQL</li>
</ul>
</div>
<div id="encoding-and-csvs" class="section level4 unnumbered">
<h4>Encoding and CSVs</h4>
<p>Use unicode. This means you should convert inputs that include non-ASCII characters to unicode as early as possible in your data processing workflow. If you are outputting to text files, these should be encoded in utf-8. Your output csvs should pass <a href="https://csvlint.io/">this</a> csv linter.</p>
</div>
<div id="sql" class="section level4 unnumbered">
<h4>SQL</h4>
<ul>
<li>Use Postgres or SQLite where possible, rather than other SQL database backends.</li>
</ul>
</div>
<div id="gis" class="section level4 unnumbered">
<h4>GIS</h4>
<ul>
<li>Use PostGIS as your GIS backend</li>
<li>Prefer conducting your GIS analysis in code, e.g. using SQL, rather than point and click in a GUI</li>
<li>Use QGIS if you need a GUI.</li>
</ul>
</div>
<div id="javascript" class="section level4 unnumbered">
<h4>Javascript</h4>
<ul>
<li>Use Vega or Vega-lite for pre-constructed charting</li>
<li>Use d3.js for custom charting</li>
<li>Use leaflet.js for mapping.</li>
<li>Use Bootstrap as a style template</li>
<li>Use underscore.js for data manipulation</li>
</ul>
</div>
<div id="finally" class="section level4 unnumbered">
<h4>Finally</h4>
<ul>
<li>If you think of something else we should be doing or using by default, please clone the repo and submit a pull request featuring that addition :)</li>
</ul>
</div>
</div>
<div id="structure2" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Code structure</h3>
<p>There should be clear logical separation of parameters, assumptions, data and code.<br />
* MOJ data should never be committed to the Github repository - even a ‘private’ repo isn’t secure. Instead, data should be stored in an s3 bucket or in Athena. [Link to ap guidance].<br />
* Small data files that are not MOJ data can be committed to the Github repo (e.g. parameters, csv containing assumptions, mock data for unit tests, lookup table) - these should be stored in a ‘data’ folder within the project folder.[Link to github with example project structure]<br />
* Prefer text format (e.g. csv) to Excel<br />
* It should be easy for others to change parameters and data without needed to understand the full codebase.</p>
</div>
<div id="functions" class="section level3">
<h3><span class="header-section-number">3.4.4</span> Abstractions</h3>
<p>Where appropriate, abstractions should be used if possible, e.g. functions, packages, modules etc. This makes codeeasier to understand, maintain and extend.
For R, you should use packages as fundamental units of code. For Python, you should factor code out into modules. In javascript, you should generally be using multiple <code>.js</code> files. For visualisation code, there should be a separation of concerns between the data model, and the code that visualises your data.</p>
<p>If you end up using a piece of code 3 times, it’s probably worth turning it into a function and separating it out into a separate script. For more information on how to write functions, see <a href="https://github.com/moj-analytical-services/writing_functions_in_r">here</a>. As a general rule, functions should be less than about 50 lines long.</p>
<p>All non trivial functions are documented using the programming language’s accepted standard.
This means that other users can understand your code more easily. If your functions are short and well documented, there is often little need for additional code comments.
For Python follow <a href="https://www.python.org/dev/peps/pep-0008/">PEP8</a> and particularly <a href="https://www.python.org/dev/peps/pep-0257/">PEP257</a>.
For R, use <code>roxygen2</code> to document your functions.</p>
<p><em>Cut this?</em>
If using a notebook (e.g. an R or Jupyter notebook) for your write up, functions are factored out to maintain narrative. Notebooks can also be useful for other purposes, such as functioning as a way of describing exploratory analysis. Where notebooks are used for this type of purpose, they can be more free-form. This makes your logic easier to follow For Python, code should be factored out into modules. For R, factor out code either into a <code>source()</code>ed <code>.R</code> file or a package</p>
</div>
<div id="style" class="section level3">
<h3><span class="header-section-number">3.4.5</span> Coding style</h3>
<p>For R, follow <a href="http://adv-r.had.co.nz/Style.html">Hadley’s Style Guide</a>
For Python, follow [PEP8]</p>
<p>An easy way to check your code formatting is to…</p>
<div id="linter" class="section level4">
<h4><span class="header-section-number">3.4.5.1</span> Apply a linter</h4>
<p>Apply a linter to easily review your code formatting. This means our coding style will be consistent across projects. It will also make it easier for others to understand our code.</p>
<p>In RStudio, the keyboard shortcut ‘ctrl+shift+A’ will reformat your code and automate some of the process of passing the linter. If you apply the linter as you work, rather than at the end, you will find it much easier to write code that passes the linter first time.</p>
<ul>
<li>For R use <a href="https://cran.r-project.org/web/packages/lintr/readme/README.html">Lintr</a> and follow <a href="http://adv-r.had.co.nz/Style.html">Hadley’s Style Guide</a><br />
</li>
<li>For Python, use [pylint] and follow [PEP8]</li>
</ul>
</div>
<div id="package-name" class="section level4">
<h4><span class="header-section-number">3.4.5.2</span> Package name</h4>
<p>It’s best practice to use the package name when calling a function. For example, using dplyr::mutate() rather than just mutate().</p>
</div>
<div id="names" class="section level4">
<h4><span class="header-section-number">3.4.5.3</span> Names have power and purpose - use them wisely</h4>
<ul>
<li>Don’t be cute or jokey when naming things.</li>
<li>Names convey meaning - well-named functions &amp; variables can remove the need for a comment and make life a little easier for other readers, including your future self!</li>
<li>Avoid meaningless names like ‘obj’ / ‘result’ / ‘foo’.</li>
<li>Use single-letter variables only where the letter represents a well-known mathematical property (e.g. e = mc^2), or where their meaning is otherwise clear</li>
</ul>
</div>
<div id="ccc" class="section level4">
<h4><span class="header-section-number">3.4.5.4</span> Code should be correct, clear, concise - in that order</h4>
<ul>
<li>Correct means demonstrably correct - with tests (ideally) and / or documented <a href="quality_assurance.md">Quality Assurance</a>. Automated tests are ideal because they allow the code to be refactored with confidence.</li>
<li>All fixes &amp; new features should include tests to prevent regressions (i.e. reappearance of the bug you just fixed).</li>
<li>Choose clarity over cleverness - use advanced language tricks with care.</li>
<li>Code should be <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a> - which stands for ‘Don’t Repeat Yourself’. - The <a href="https://en.wikipedia.org/wiki/Rule_of_three_(computer_programming)">‘Rule of Three’</a> is a good approach to managing duplication. Less code is usually better - but not at the expense of clarity.<br />
</li>
<li>To help with clarity and establish patterns within the team, please use either the <a href="https://pypi.python.org/pypi/pep8">PEP8</a> style guide (for Python) or <a href="https://github.com/jimhester/lintr">LintR</a> (for R). The relavant linters will help you with this.</li>
<li>Ensure that your tests and linters run automatically on all pull requests, if that is possible, by setting up <a href="https://travis-ci.org/">TravisCI</a> on your repo. This will probably be more complicated than it is worth if your repo is private due to restrictions that are applied to the free TravisCI accounts.</li>
<li>Use code comments judiciously:</li>
</ul>
<blockquote>
<p>Good code is its own best documentation. As you’re about to add a comment, ask yourself, “How can I improve the code so that this comment isn’t needed?” Improve the code and then document it to make it even clearer.” - Steve McConnell</p>
</blockquote>
<p>Code is appropriately commented.
[Comments are for explaining why something is needed, not how it works.] (<a href="https://github.com/moj-analytical-services/our-coding-standards/blob/7e751164d577b521e7f62484a68ee1861f8ae4ac/they_are_users_too.md#L4" class="uri">https://github.com/moj-analytical-services/our-coding-standards/blob/7e751164d577b521e7f62484a68ee1861f8ae4ac/they_are_users_too.md#L4</a>)
Appropriate use of comments means it is easier to understand how code works at a later date. Before commenting, consider whether the comment fits better into the function’s documentation than in a comment.</p>
</div>
<div id="errors" class="section level4">
<h4><span class="header-section-number">3.4.5.5</span> Everything fails at some point</h4>
<p>Accept this and code defensively when calling other services.
Every HTTP call could error or hang - handle failures appropriately and fail fast. Don’t let long-running external calls impact your user experience.
Aim to provide useful information to end users and people working on the code, when something fails.</p>
</div>
<div id="users" class="section level4">
<h4><span class="header-section-number">3.4.5.6</span> Other team members are users too - treat them with respect</h4>
<p>If you have to explain how your code works, then your code is not clear enough.
Be nice to your future self (and assume that they will have forgotten the exact thought process that led to that bit of code you just wrote).
Comments are for explaining why something is needed, not how it works.
Make your commit messages as <a href="https://robots.thoughtbot.com/5-useful-tips-for-a-better-commit-message">informative as possible</a></p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="wf.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-version.pdf", "bookdown-version.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
